{% if not currentUser %}
	{% redirect 'social/login' %}
{% endif %}

{% extends "social/_layouts/site" %}

{% set selectedNav = 'password' %}

{% block main %}
	<h2>Password</h2>

	{% if user is defined %}
		{% set userErrors = user.errors %}

		{% if userErrors %}
			<div class="alert alert-danger">
				{% for userError in userErrors %}
					<p>{{(userError|first)}}</p>
				{% endfor %}
			</div>
		{% endif %}
	{% endif %}

	{% if currentUser.password %}
		<form method="post" enctype="multipart/form-data">

			<input type="hidden" name="action" value="users/save-user">
			<input type="hidden" name="userId" value="{{ currentUser.id }}">
			{{ redirectInput('social/password') }}

			<div class="form-group">
				<label for="currentPassword">Current Password</label>
				<input class="form-control" type="password" id="currentPassword" name="password" />
			</div>

			<div class="form-group">
				<label for="newPassword">New Password</label>
				<input class="form-control" type="password" id="newPassword" name="newPassword" />
			</div>

			<input type="submit" class="btn btn-primary" value="Update Password">
		</form>
	{% else %}
		<form method="post">
			<input type="hidden" name="action" value="users/sendPasswordResetEmail">
			<input type="hidden" name="loginName" value="{{ currentUser.email }}">

			<p>Your password has never been set yet.</p>
			<input type="submit" class="btn btn-primary" value="Set Your Password" />
		</form>
	{% endif %}
{% endblock %}
